<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Gas Cloud – Stock 2</title>

<!-- Telegram Mini App SDK -->
<script src="https://telegram.org/js/telegram-web-app.js?v=6"></script>

<style>
/* ===== BASE ===== */
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  background: #000;
  color: #fff;
}

/* ===== BACK ===== */
.back {
  position: fixed;
  top: calc(12px + env(safe-area-inset-top));
  left: 12px;
  background: rgba(20,20,20,0.9);
  border-radius: 14px;
  padding: 10px 14px;
  font-weight: 700;
  cursor: pointer;
  z-index: 10;
}

/* ===== GRID ===== */
.products {
  padding: 70px 16px 20px;
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 14px;
}

/* ===== PRODUCT CARD ===== */
.product {
  background: linear-gradient(180deg, #1a1a1a, #0c0c0c);
  border-radius: 18px;
  padding: 10px;
  cursor: pointer;
  border: 1px solid rgba(255,255,255,0.08);
}

/* MEDIA */
.media {
  aspect-ratio: 1 / 1;
  border-radius: 14px;
  overflow: hidden;
  background: #000;
}

.media img,
.media video {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* NAME */
.name {
  margin-top: 8px;
  text-align: center;
  font-size: 13px;
  font-weight: 700;
}

/* ===== MODAL ===== */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.95);
  display: none;
  flex-direction: column;
  z-index: 999;
}

.modal-media {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal-media img,
.modal-media video {
  width: 100%;
  max-height: 100%;
  object-fit: contain;
}

.modal-info {
  padding: 20px;
  background: #111;
}

.price {
  font-size: 22px;
  font-weight: 900;
  text-align: center;
  margin-bottom: 14px;
}

/* ORDER */
.order {
  background: #00ff99;
  color: #000;
  padding: 16px;
  border-radius: 18px;
  font-weight: 900;
  text-align: center;
  cursor: pointer;
}

.close {
  margin-top: 12px;
  text-align: center;
  opacity: 0.6;
  cursor: pointer;
}
</style>
</head>

<body>

<!-- BACK -->
<div class="back" onclick="goBack()">⬅ BACK</div>

<!-- PRODUCTS -->
<div class="products" id="products"></div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-media" id="modalMedia"></div>
  <div class="modal-info">
    <div class="price" id="modalPrice"></div>
    <div class="order" onclick="order()">ORDINA</div>
    <div class="close" onclick="closeModal()">Chiudi</div>
  </div>
</div>

<script>
/* ===== TELEGRAM INIT ===== */
const tg = window.Telegram.WebApp;
tg.ready();
tg.expand();
tg.BackButton.show();
tg.BackButton.onClick(goBack);

/* ===== CONFIG ===== */
const CATEGORY = "stock2";
const CONTACT_USERNAME = "gascloud2";
let selectedProduct = null;

/* ===== BACK ===== */
function goBack() {
  tg.BackButton.hide();
  window.location.href = "catalog.html";
}

/* ===== LOAD PRODUCTS ===== */
fetch("products.json?v=" + Date.now())
  .then(res => res.json())
  .then(products => {
    const box = document.getElementById("products");

    products
      .filter(p => p.category === CATEGORY)
      .forEach(p => {
        const card = document.createElement("div");
        card.className = "product";

        const media =
          p.mediaType === "video"
            ? `<video src="${p.mediaUrl}" muted></video>`
            : `<img src="${p.mediaUrl}" alt="${p.name}">`;

        card.innerHTML = `
          <div class="media">${media}</div>
          <div class="name">${p.name}</div>
        `;

        card.onclick = () => openModal(p);
        box.appendChild(card);
      });
  });

/* ===== MODAL ===== */
function openModal(p) {
  selectedProduct = p;

  const mediaBox = document.getElementById("modalMedia");
  mediaBox.innerHTML =
    p.mediaType === "video"
      ? `<video src="${p.mediaUrl}" autoplay controls></video>`
      : `<img src="${p.mediaUrl}">`;

  document.getElementById("modalPrice").innerText = "€" + p.price;
  document.getElementById("modal").style.display = "flex";
}

function closeModal() {
  document.getElementById("modal").style.display = "none";
}

/* ===== ORDER ===== */
function order() {
  if (!selectedProduct) return;

  const message = encodeURIComponent(selectedProduct.name);
  window.open(`https://t.me/${CONTACT_USERNAME}?text=${message}`, "_blank");
}
</script>

</body>
</html>

